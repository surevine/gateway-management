@(repository: Repository, partnerForm: DynamicForm)

@import helper._

@implicitFieldConstructor = @{ FieldConstructor(utils.twitterBootstrapInput.render) }

@partnerCount = @{ Partner.FIND.all().size() }

@partners = @{ Partner.getFederationOptions(repository) }

@main("Federate repository") {

	@if(partnerCount == 0) {

		<div class="panel panel-warning">
		  <div class="panel-heading">
		    <h3 class="panel-title">No partners</h3>
		  </div>
		  <div class="panel-body">
		    <p>No partners have been configured. Please <a href="@routes.Partners.add()">add a partner</a>.</p>
		  </div>
		</div>

	} else {

		<section>
			<h4>Repository</h4>
			<p>@repository.identifier (@repository.repoType)</p>

			@if(partners.isEmpty) {

				<section>
					<h4>Partner</h4>
					<p>Select the partner you wish to federate repository with:</p>
				</section>

				<div class="panel panel-warning all-configured">
					<div class="panel-heading">
						<h3 class="panel-title">All partners federated</h3>
					</div>
					<div class="panel-body">
						<p>Repository has been federated with all configured partners. Please <a href="@routes.Partners.add()">add another partner</a>.</p>
					</div>
				</div>

			} else {

				@form(routes.FederationConfigurations.create(), 'role -> "form") {

					<fieldset>
						<input type="hidden" name="source" value="repository" />
						<input type="hidden" name="repositoryId" value="@repository.id" />

						<section>
							<h4>Partner</h4>
							<p>Select the partner you wish to federate repository with:</p>
							<select name="partnerId" class="form-control">
							@for(partner <- partners) {
								<option value="@partner.id">@partner.name</option>
							}
							</select>
						</section>
						<section>
							<h4>Federation Type</h4>
							<p>Select the inital federation configuration (this can be modified):</p>

							<div class="radio">
								<label>
									<input type="radio" name="federationType" value="bidirectional" checked />
									<h5>Bi-directional</h5>
									<p>Enable both inbound and outbound federation. Send and receive updates made to the repository to/from the partner partner. </p>
								</label>
							</div>
							<div class="radio">
								<label>
									<input type="radio" name="federationType" value="outbound" />
									<h5>Outbound-only</h5>
									<p>Only enable outbound federation. Send updates made to the repository to the partner partner, but ignore any updates received from partners.</p>
								</label>
							</div>
							<div class="radio">
								<label>
									<input type="radio" name="federationType" value="inbound" />
									<h5>Inbound-only</h5>
									<p>Only enable inbound federation. Receive updates to repository made by partners, but don't send any local updates.</p>
								</label>
							</div>
						</section>
					</fieldset>

					<div class="actions">
						<input type="submit" value="Federate repository" data-loading-text="Submitting..." class="btn btn-primary submit">
						<a href="@routes.Repositories.list()" class="btn btn-default">Cancel</a>
					</div>

				}

			}

		</section>

	}

	<script type="text/javascript">
		$( document ).ready(function() {
			$('.submit').on('click', function () {
			    $(this).button('loading');
			});
		});
	</script>

}
